<!-- Content Header (Page header) -->
<section class="content-header">
  <h1>
    Dashboard
    <small>Control panel</small>
  </h1>
  <ol class="breadcrumb">
    <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
    <li class="active">Dashboard</li>
  </ol>
</section>

<!-- Main content -->
<section class="content">
  <!-- Small boxes (Stat box) -->
  <div class="row">
    <div class="col-lg-4 col-xs-6">
      <!-- small box -->
      <div class="small-box bg-aqua">
        <div class="inner">
          <h3><%= Item.all.count %></h3>

          <p>Total Items</p>
        </div>
        <div class="icon">
          <i class="ion ion-bag"></i>
        </div>
        <a href="<%= admin_items_path %>" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
      </div>
    </div>
    <!-- ./col -->
    <div class="col-lg-4 col-xs-6">
      <!-- small box -->
      <div class="small-box bg-green">
        <div class="inner">
          <h3><%= Requisition.all.count %></h3>

          <p>Total Requisitions</p>
        </div>
        <div class="icon">
          <i class="ion ion-stats-bars"></i>
        </div>
        <a href="<%= requisitions_path %>" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
      </div>
    </div>
    <!-- ./col -->
    <div class="col-lg-4 col-xs-6">
      <!-- small box -->
      <div class="small-box bg-yellow">
        <div class="inner">
          <h3><%= User.all.count %></h3>

          <p>Total Registered Users</p>
        </div>
        <div class="icon">
          <i class="ion ion-person-add"></i>
        </div>
        <a href="<%= admin_users_path %>" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
      </div>
    </div>
    <!-- ./col -->
  </div>
  <!-- /.row -->

  <div class="row">
    <div class="col-md-6">
      <div id="station_requisitions_map" style="position: relative; overflow: hidden;">

      </div>
    </div>
    <div class="col-md-6">
      <div class="row">
        <div class="col-md-12">
          <div class="box box-danger">
            <div class="box-header with-border">
              <h3 class="box-title">Inventory Items</h3>
            </div>
            <div class="box-body chart-responsive">
              <div class="chart" id="item-chart" style="height: 300px; position: relative;"></div>
            </div>
            <!-- /.box-body -->
          </div>
        </div>

        <div class="col-md-12">
          <div class="box box-success">
            <div class="box-header with-border">
              <h3 class="box-title">Requisition per Stations</h3>
            </div>
            <div class="box-body chart-responsive">
              <div class="chart" id="bar-chart" style="height: 300px;"></div>
            </div>
            <!-- /.box-body -->
          </div>
        </div>
      </div>
    </div>
  </div>

</section>
<!-- /.content -->

<script type="text/javascript">
  $(document).ready(function () {

    var lat = 23.73;
    var long = 90.41;
    var map = new google.maps.Map(document.getElementById('station_requisitions_map'), {
      zoom: 8,
      center: new google.maps.LatLng(lat, long),
      mapTypeId: google.maps.MapTypeId.ROADMAP
    });

    var locations = <%=raw @stations %>;

    var infowindow = new google.maps.InfoWindow();

    var marker, i;

    for (i = 0; i < locations.length; i++) {
      marker = new google.maps.Marker({
        position: new google.maps.LatLng(locations[i][3], locations[i][4]),
        map: map
      });

      google.maps.event.addListener(marker, 'click', (function (marker, i) {
        return function () {
          var html = "<b> Station: " + locations[i][1] + "</b> <br/>" +
              "<b> Requisitions: " + locations[i][5] + "</b>";
          infowindow.setContent(html);
          infowindow.open(map, marker);
        }
      })(marker, i));
    }

    // donut chart

    function get_items(){
      var items = <%=raw @items%>;
      var modified_items = [];
      for (i = 0; i < items.length; i++) {
        modified_items[i] = {label: items[i][0], value: items[i][1]};
      }
      return modified_items;
    }

    var donut = new Morris.Donut({
      element: 'item-chart',
      resize: true,
      colors: randomColor({
        count: <%=raw @items.count %>,
        hue: 'green'
      }),
      data: get_items(),
      hideHover: 'auto'
    });

    //BAR CHART
    var bar = new Morris.Bar({
      element: 'bar-chart',
      resize: true,
      data: [
        <% @stations.each do |station| %>
        {y: '<%= station[1] %>', a: '<%= station[5] %>'},
        <% end %>
      ],
      barColors: ['#00a65a', '#f56954'],
      xkey: 'y',
      ykeys: ['a'],
      labels: ['Requisition'],
      hideHover: 'auto'
    });
  })
</script>